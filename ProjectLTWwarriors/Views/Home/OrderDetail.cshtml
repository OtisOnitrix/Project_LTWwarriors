@model ProjectLTWwarriors.Models.DonHang
@{
    ViewBag.Title = "Chi tiết đơn hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
    Func<decimal, string> money = n => string.Format("{0:#,0}₫", n);
}

<div class="container" style="margin-top:40px; margin-bottom:60px;">
    <h2 style="font-weight:700; text-align:center; margin-bottom:25px;">
        Chi tiết đơn hàng
    </h2>

    <!-- ===== Thông tin đơn hàng & người nhận ===== -->
    <div style="display:flex; flex-wrap:wrap; gap:30px; margin-bottom:30px;">
        <div style="flex:1; min-width:280px;">
            <h4>Thông tin đơn hàng</h4>
            <p><b>Mã đơn:</b> @Model.MaDon</p>
            <p><b>Ngày đặt:</b> @Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</p> @*dòng CreateAt đó thể hiện cho biết khi đặt sẽ lấy thời gian thực tế lúc đặt*@

            @{
                var color = "#10b981"; // mặc định

                if (Model.TrangThai == "paid")
                {
                    color = "#2563eb";
                }
                else if (Model.TrangThai == "shipping")
                {
                    color = "#f59e0b";
                }
                else if (Model.TrangThai == "completed")
                {
                    color = "#16a34a";
                }
                else if (Model.TrangThai == "cancelled")
                {
                    color = "#dc2626";
                }
            }
            @*các dữ liệu như là sđt, tên hay địa chỉ hay phương thức thanh toán nằm bên File GioHangCoSanPham.cshtml*@
            <p>
                <b>Trạng thái:</b>
                <span style="background:@color; color:#fff; padding:3px 10px; border-radius:8px;">
                    @Model.TrangThai
                </span>
            </p>
            <p><b>Phương thức thanh toán:</b> @Model.PhuongThucThanhToan</p>
            @if (!string.IsNullOrEmpty(Model.MaKhuyenMai))
            {
                <p><b>Mã khuyến mãi:</b> @Model.MaKhuyenMai</p>
            }
        </div>

        <div style="flex:1; min-width:280px;">
            <h4>Người nhận</h4>
            <p><b>Họ tên:</b> @Model.HoTen</p>
            <p><b>Số điện thoại:</b> @Model.SoDienThoai</p>
            <p><b>Địa chỉ giao hàng:</b> @Model.DiaChiDayDu</p>
        </div>
    </div>

    <!-- ===== Danh sách sản phẩm ===== -->
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Tên sản phẩm</th>
                <th class="text-center">Đơn giá</th>
                <th class="text-center">Số lượng</th>
                <th class="text-center">Thành tiền</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Items)
            {
                <tr>
                    <td>@item.SanPham.Name</td>
                    <td class="text-center">@money((decimal)item.SanPham.Price)</td>
                    <td class="text-center">@item.SoLuong</td>
                    <td class="text-center">@money((decimal)item.SanPham.Price * item.SoLuong)</td>
                </tr>
            }
        </tbody>
    </table>

    <!-- ===== Tổng kết đơn hàng ===== -->
    <div style="display:flex; justify-content:flex-end; margin-top:20px;">
        <div style="min-width:320px;">
            <div style="display:flex; justify-content:space-between;">
                <span>Tạm tính</span>
                <b>@money(Model.TamTinh)</b>
            </div>
            <div style="display:flex; justify-content:space-between;">
                <span>Phí vận chuyển</span>
                <b>@money(Model.PhiVanChuyen)</b>
            </div>
            <div style="display:flex; justify-content:space-between;">
                <span>Giảm giá</span>
                <b>-@money(Model.GiamGia)</b>
            </div>
            <hr />
            <div style="display:flex; justify-content:space-between; font-size:18px;">
                <span><b>Tổng cộng</b></span>
                <b style="color:#dc2626;">@money(Model.TongCong)</b>
            </div>
        </div>
    </div>

    <!-- ===== Nút điều hướng ===== -->
    <div style="text-align:center; margin-top:40px;">
        <a href="@Url.Action("LandingPage", "Home")"
           style="background:#2563eb; color:white; padding:10px 24px; border-radius:8px; text-decoration:none;">
            Về trang chủ
        </a>
        <a href="@Url.Action("ThanhToanThanhCong", "Home")"
           style="margin-left:10px; background:#10b981; color:white; padding:10px 24px; border-radius:8px; text-decoration:none;">
            Xem lại thanh toán
        </a>
    </div>
</div>
